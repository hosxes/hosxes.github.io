<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>高精度URL提取器</title>
    <style>
        /* 保持原有样式不变 */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: -apple-system, sans-serif; padding: 15px; background: #f5f5f5; }
        /* 其他样式与之前相同 */
    </style>
</head>
<body>
    <div class="container">
        <h1>高精度URL提取器</h1>
        <textarea id="inputText" placeholder="粘贴包含URL的文本..."></textarea>
        <button onclick="extractUrls()">提取URL</button>
        <div id="results"></div>
    </div>
    <div class="toast" id="toast">已复制</div>

    <script>
        function extractUrls() {
            const text = document.getElementById('inputText').value;
            
            // 最终优化版正则表达式
            const urlRegex = /https?:\/\/(?:www\.)?(?:[^\s/?#]+\.[^\s/?#]{2,})(?:[^\s?#]*)(?:\?[^\s#]*)?(?:#[^\s]*)?/gi;
            
            const matches = text.match(urlRegex) || [];
            
            // 精确过滤处理
            const urls = matches.map(url => {
                // 移除所有尾部非URL合法字符（包括中文）
                return url.replace(/[^a-zA-Z0-9-_~:/?#@!$&'()*+,;=.%]+$/g, '');
            }).filter(url => {
                // 验证URL格式
                try {
                    new URL(url);
                    return url.length > 10;
                } catch {
                    return false;
                }
            });

            displayResults(urls);
        }

        function displayResults(urls) {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = urls.length ? 
                urls.map(url => `<div class="result-item">${url}</div>`).join('') :
                '<div class="result-item">未找到有效URL</div>';

            // 添加点击事件
            document.querySelectorAll('.result-item').forEach((item, index) => {
                item.onclick = () => copyToClipboard(urls[index]);
            });
        }

        // 保持原有复制功能不变
        function copyToClipboard(text) { /* 同上 */ }
        function showToast() { /* 同上 */ }
    </script>
</body>
</html>
